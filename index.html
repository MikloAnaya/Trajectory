<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Trajectory — Stage 2</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar__inner">
        <div class="brand">
          <div class="brand__mark">
            <img id="appIcon" src="./build/icon.png" alt="Trajectory" onerror="this.style.display='none'" />
            <span class="brand__fallback">T</span>
          </div>
          <div>
            <div class="brand__name">Trajectory</div>
            <div class="brand__tag" id="weekLabel">Overview</div>
          </div>
        </div>

        <div class="topbar__nav">
          <!-- Page-specific week/month nav moved into each page; header kept minimal -->

          <div class="divider"></div>

          <button class="btn btn--ghost" id="tabHome" type="button" aria-pressed="false">Home</button>
          <button class="btn btn--ghost" id="tabMonth" type="button" aria-pressed="false">Calendar</button>
          <button class="btn btn--ghost" id="tabPlan" type="button" aria-pressed="false">Plan</button>
          <button class="btn btn--ghost" id="tabStats" type="button" aria-pressed="false">Stats</button>
          <button class="btn btn--ghost" id="tabWorkout" type="button" aria-pressed="false">Workout</button>
          <button class="btn btn--ghost" id="tabBlocker" type="button" aria-pressed="false">Blocker</button>
          <button class="btn btn--ghost" id="tabSettings" type="button" aria-pressed="false">Settings</button>

          <div class="divider"></div>
          <div class="topbar__actions">
            <button class="btn btn--primary" id="btnAddCommitment" type="button">Add Commitment</button>
          </div>
        </div>
      </div>
    </header>

    <main class="container" id="app" aria-live="polite"></main>

    <!-- Commitment modal -->
    <div class="modal" id="commitModal" role="dialog" aria-modal="true" aria-labelledby="commitTitle" hidden>
      <div class="modal__backdrop" data-close="true"></div>

      <div class="modal__panel" role="document">
        <div class="modal__header">
          <h2 id="commitTitle">Add Commitment</h2>
          <button class="iconbtn" type="button" aria-label="Close" data-close="true">✕</button>
        </div>

        <form id="commitForm" class="modal__body commit-form">
          <div class="modal__section">
            <div class="modal__section-title">Basics</div>
            <div class="field field--inline field--status">
              <span class="field__label">Status</span>
              <div style="display:flex;align-items:center;gap:10px;">
                <span class="faint" id="cDoneLabel">Pending</span>
                <label class="toggle" for="cDone">
                  <input id="cDone" type="checkbox" />
                  <span class="toggle__ui"></span>
                </label>
              </div>
            </div>
            <label class="field">
              <span class="field__label">Title</span>
              <input id="cTitle" class="input" type="text" maxlength="80" placeholder="Study Physics" required />
            </label>

            <label class="field">
              <span class="field__label">Notes (optional)</span>
              <input id="cDeliverable" class="input" type="text" maxlength="120" placeholder="Optional notes or outcome" />
            </label>

            <label class="field">
              <span class="field__label">Color</span>
              <div class="color-row">
                <div class="color-preview" id="cColorPreview"></div>
                <div class="color-swatches" id="cColorSwatches">
                  <button class="color-swatch" type="button" data-color="#0EA5E9" style="background:#0EA5E9" aria-label="Sky"></button>
                  <button class="color-swatch" type="button" data-color="#14B8A6" style="background:#14B8A6" aria-label="Teal"></button>
                  <button class="color-swatch" type="button" data-color="#22C55E" style="background:#22C55E" aria-label="Green"></button>
                  <button class="color-swatch" type="button" data-color="#84CC16" style="background:#84CC16" aria-label="Lime"></button>
                  <button class="color-swatch" type="button" data-color="#F59E0B" style="background:#F59E0B" aria-label="Amber"></button>
                  <button class="color-swatch" type="button" data-color="#F97316" style="background:#F97316" aria-label="Orange"></button>
                  <button class="color-swatch" type="button" data-color="#EF4444" style="background:#EF4444" aria-label="Red"></button>
                  <button class="color-swatch" type="button" data-color="#6366F1" style="background:#6366F1" aria-label="Indigo"></button>
                </div>
                <div class="color-custom">
                  <input id="cColor" class="color-input" type="color" value="#0EA5E9" aria-label="Custom color" />
                  <input id="cColorHex" class="input input--sm" type="text" value="#0EA5E9" maxlength="7" placeholder="#0EA5E9" />
                </div>
              </div>
            </label>

            <div class="field">
              <span class="field__label">Icon (optional)</span>
              <input id="cIcon" type="hidden" value="" />
              <div class="icon-picker" id="cIconPicker" role="group" aria-label="Task icon">
                <button class="icon-choice" type="button" data-icon="auto" aria-label="Auto icon" aria-pressed="true">
                  <span class="icon-choice__none">Auto</span>
                </button>
                <button class="icon-choice" type="button" data-icon="none" aria-label="No icon" aria-pressed="false">
                  <span class="icon-choice__none">None</span>
                </button>
                <button class="icon-choice" type="button" data-icon="school" aria-label="School" aria-pressed="false">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 7l9-4 9 4-9 4-9-4z" /><path d="M7 10v6c0 1 2.5 3 5 3s5-2 5-3v-6" /><path d="M21 11v6" /></svg>
                </button>
                <button class="icon-choice" type="button" data-icon="dumbbell" aria-label="Physical" aria-pressed="false">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 8v8" /><path d="M17 8v8" /><path d="M5 10v4" /><path d="M19 10v4" /><path d="M7 12h10" /></svg>
                </button>
                <button class="icon-choice" type="button" data-icon="brain" aria-label="Self improvement" aria-pressed="false">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 4a3 3 0 00-3 3v1a3 3 0 000 6v1a3 3 0 003 3" /><path d="M15 4a3 3 0 013 3v1a3 3 0 010 6v1a3 3 0 01-3 3" /><path d="M9 7h.01" /><path d="M15 7h.01" /><path d="M12 4v16" /></svg>
                </button>
                <button class="icon-choice" type="button" data-icon="idea" aria-label="Idea" aria-pressed="false">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 21h6" /><path d="M10 17h4" /><path d="M12 2a7 7 0 00-4 12c.7.6 1 1.3 1 2h6c0-.7.3-1.4 1-2a7 7 0 00-4-12z" /></svg>
                </button>
                <button class="icon-choice" type="button" data-icon="home" aria-label="Home" aria-pressed="false">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M14 3l7 7-3 3-7-7z" /><path d="M2 22l6-2-4-4-2 6z" /><path d="M6 16l8-8" /></svg>
                </button>
              </div>
              <div class="meta">Used in the Home day tracker.</div>
            </div>
            <label class="field field--inline">
              <span class="field__label">Focus</span>
              <div class="toggle">
                <input id="cFocus" type="checkbox" />
                <span class="toggle__ui"></span>
              </div>
            </label>
            <label class="field field--inline" id="cAutopilotPinRow" hidden>
              <span class="field__label">Pin (autopilot won't move)</span>
              <div class="toggle">
                <input id="cAutopilotPin" type="checkbox" />
                <span class="toggle__ui"></span>
              </div>
            </label>
            <div class="meta" id="cAutopilotPinHelp" hidden>Only shown for school autopilot work blocks.</div>
          </div>

          <div class="modal__section">
            <div class="modal__section-title">Schedule</div>
            <div class="row">
              <label class="field">
                <span class="field__label">Estimate (hours)</span>
                <input id="cHours" class="input" type="number" min="0" step="0.5" value="2" required />
              </label>

              <label class="field">
                <span class="field__label">Day</span>
                <select id="cDay" class="input"></select>
              </label>
            </div>

            <div class="row row--3">
              <label class="field">
                <span class="field__label">Target date (optional)</span>
                <input id="cDate" class="input" type="date" />
              </label>

              <label class="field">
                <span class="field__label">Time (optional)</span>
                <input id="cTime" class="input" type="time" />
              </label>

              <label class="field">
                <span class="field__label">Duration (mins, optional)</span>
                <input id="cDuration" class="input" type="number" min="0" step="1" placeholder="Leave blank for auto duration" />
              </label>
            </div>

            <label class="field">
              <span class="field__label">Repeat</span>
              <div style="display:flex;gap:8px;align-items:center">
                <select id="cRepeatFreq" class="input" style="width:160px">
                  <option value="once">Once</option>
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="custom">Custom</option>
                </select>
                <input id="cRepeatInterval" class="input" type="number" min="1" value="1" style="width:80px" />
                <div style="font-size:12px;color:var(--muted);">every</div>
              </div>
            </label>

            <div id="repeatOptions" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
              <div id="repeatWeeklyOpts" style="display:none;align-items:center;gap:6px">
                <label><input type="checkbox" value="MO" class="repeat-wd"/>Mon</label>
                <label><input type="checkbox" value="TU" class="repeat-wd"/>Tue</label>
                <label><input type="checkbox" value="WE" class="repeat-wd"/>Wed</label>
                <label><input type="checkbox" value="TH" class="repeat-wd"/>Thu</label>
                <label><input type="checkbox" value="FR" class="repeat-wd"/>Fri</label>
                <label><input type="checkbox" value="SA" class="repeat-wd"/>Sat</label>
                <label><input type="checkbox" value="SU" class="repeat-wd"/>Sun</label>
              </div>
              <div id="repeatMonthlyOpts" style="display:none">
                <label class="field">
                  <span class="field__label">Day of month</span>
                  <input id="cRepeatMonthDay" class="input" type="number" min="1" max="31" value="1" style="width:100px" />
                </label>
              </div>
              <div id="repeatUntilOpt" style="display:none">
                <label class="field">
                  <span class="field__label">Until (optional)</span>
                  <input id="cRepeatUntil" class="input" type="date" />
                </label>
              </div>
            </div>
          </div>

          <div class="modal__section">
            <div class="modal__section-title">Details</div>
            <label class="field">
              <span class="field__label">Next action (optional)</span>
              <input id="cNext" class="input" type="text" maxlength="120" placeholder="Outline writeup + create repo" />
            </label>

            <div class="row">
              <label class="field">
                <span class="field__label">Stat (what does this develop?)</span>
                <select id="cStat" class="input">
                  <option value="STR">Strength (STR)</option>
                  <option value="INT">Intelligence (INT)</option>
                  <option value="DISC">Discipline (DISC)</option>
                </select>
              </label>

              <label class="field">
                <span class="field__label">Link to long-term goal (optional)</span>
                <select id="cLinkGoal" class="input">
                  <option value="">(none)</option>
                </select>
              </label>
            </div>

            <label class="field">
              <span class="field__label">Proof URL (optional)</span>
              <input id="cProof" class="input" type="url" placeholder="https://..." />
            </label>
          </div>

          <div class="modal__footer">
            <button class="btn btn--danger" id="btnDeleteCommit" type="button" hidden>Delete</button>
            <button class="btn btn--ghost" id="btnCommitCancel" type="button" data-close="true">Cancel</button>
            <button class="btn btn--primary" id="btnCommitSave" type="submit">Save</button>
          </div>
        </form>

        <div class="modal__hint">
          Stage 2: commitments persist locally (localStorage). No accounts yet.
        </div>
      </div>
    </div>

    <!-- Morning Gate modal (forced) -->
    <div class="modal" id="morningGateModal" role="dialog" aria-modal="true" aria-labelledby="morningGateTitle" hidden>
      <div class="modal__backdrop"></div>

      <div class="modal__panel" role="document">
        <div class="modal__header">
          <h2 id="morningGateTitle">Start Your Day</h2>
        </div>

        <form id="morningGateForm" class="modal__body">
          <div class="meta">Enter 3 goals. Then Trajectory boots your day.</div>

          <label class="field">
            <span class="field__label">Goal 1</span>
            <input id="mgGoal1" class="input" type="text" maxlength="120" placeholder="Finish Chem homework" required />
          </label>
          <label class="field">
            <span class="field__label">Goal 2</span>
            <input id="mgGoal2" class="input" type="text" maxlength="120" placeholder="Gym (push day)" required />
          </label>
          <label class="field">
            <span class="field__label">Goal 3</span>
            <input id="mgGoal3" class="input" type="text" maxlength="120" placeholder="Read 30 pages" required />
          </label>

          <div class="modal__footer">
            <button class="btn btn--primary" id="mgStartDayBtn" type="submit">Start Day</button>
          </div>

          <div class="meta" id="mgStatus" aria-live="polite"></div>
        </form>
      </div>
    </div>
    
    <!-- Goal modal -->
    <div class="modal" id="goalModal" role="dialog" aria-modal="true" aria-labelledby="goalTitle" hidden>
      <div class="modal__backdrop" data-close="true"></div>

      <div class="modal__panel" role="document">
        <div class="modal__header">
          <h2 id="goalTitle">Add Goal</h2>
          <button class="iconbtn" type="button" aria-label="Close" data-close="true">✕</button>
        </div>

        <form id="goalForm" class="modal__body">
          <label class="field">
            <span class="field__label">Title</span>
            <input id="gTitle" class="input" type="text" maxlength="120" placeholder="Become fluent in Rust" required />
          </label>

          <label class="field">
            <span class="field__label">Category</span>
            <select id="gCategory" class="input">
              <option value="">(none)</option>
              <option value="degree">Degree</option>
              <option value="career">Career</option>
              <option value="health">Health</option>
            </select>
          </label>

          <!-- Degree-specific fields (shown when Category = Degree) -->
          <div id="degreeFields" hidden>
            <label class="field">
              <span class="field__label">Degree total credits required</span>
              <input id="gDegreeReq" class="input" type="number" min="0" step="1" value="120" />
            </label>

            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:var(--space);">
              <div class="field__label">Classes</div>
              <div><button id="gAddClass" class="btn btn--ghost" type="button">+ Add Class</button></div>
            </div>

            <div id="gClassesList" class="compact-list"></div>
          </div>

          <!-- Health-specific fields (shown when Category = Health) -->
          <div id="healthFields" hidden>
            <label class="field">
              <span class="field__label">Health Subtype</span>
              <select id="gHealthSubtype" class="input">
                <option value="general">General</option>
                <option value="bulking">Bulking</option>
                <option value="cutting">Cutting</option>
                <option value="strength">Strength</option>
              </select>
            </label>

            <div class="row">
              <label class="field">
                <span class="field__label">Current value</span>
                <input id="gHealthCurrent" class="input" type="number" step="0.1" />
              </label>

              <label class="field">
                <span class="field__label">Target value</span>
                <input id="gHealthTarget" class="input" type="number" step="0.1" />
              </label>
            </div>

            <label class="field">
              <span class="field__label">Start value (baseline, optional)</span>
              <input id="gHealthStart" class="input" type="number" step="0.1" />
            </label>

            <label class="field">
              <span class="field__label">Unit</span>
              <select id="gHealthUnit" class="input">
                <option value="kg">kg</option>
                <option value="lb">lb</option>
                <option value="reps">reps</option>
                <option value="sessions">sessions</option>
              </select>
            </label>

            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:var(--space);">
              <div class="field__label">Measurements</div>
              <div><button id="gAddMeasurement" class="btn btn--ghost" type="button">+ Add Measurement</button></div>
            </div>

            <div id="gHealthMeasurementsList" class="compact-list"></div>
          </div>

          <label class="field">
            <span class="field__label">Horizon (years)</span>
            <input id="gHorizon" class="input" type="number" min="0" step="1" value="1" />
          </label>

          <label class="field">
            <span class="field__label">Notes (optional)</span>
            <textarea id="gNotes" class="input" rows="4" placeholder="What success looks like..."></textarea>
          </label>

          <div class="modal__footer">
            <button class="btn btn--ghost" type="button" data-close="true">Cancel</button>
            <button class="btn btn--primary" type="submit">Save Goal</button>
          </div>
        </form>
      </div>
    </div>

    
    <!-- Optional: include lottie-web to enable rich coach animations.
         To activate, uncomment the following script tag. -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script> -->
    <script src="./app.js"></script>
  </body>
</html>
